# =============================================================================
# Phase 2: Parameter Optimization for Regular 1-Day Candles
# =============================================================================
# Objective: Optimize mean reversion parameters for the ONLY profitable config
# From Phase 1: Regular 1d is the clear winner (+3.98% avg, 190/268 profitable)
# Testing: 190 profitable stocks Ã— 180 parameter combos = 34,200 backtests
# =============================================================================

phase: 2
name: "Regular 1d Parameter Optimization"
description: "Grid search to optimize mean reversion parameters for regular 1-day candles"

# Use ONLY regular 1-day candles (Phase 1 winner)
candle_configs:
  - candle_type: "regular"
    aggregation_days: 1

# Parameter grid for optimization
parameter_grid:
  # Mean lookback periods (days)
  mean_lookback: [10, 15, 20, 25, 30]
  stddev_lookback: [10, 15, 20, 25, 30]  # Test same range for consistency

  # Entry thresholds (standard deviations below mean)
  entry_threshold: [1.5, 2.0, 2.5, 3.0]

  # Exit strategies
  exit_type:
    - "mean"              # Exit when price returns to mean (baseline)
    - "opposite_band"     # Exit at upper band (mean + N*stddev)
    - "profit_target"     # Exit at fixed profit percentage

  # Exit thresholds (for profit_target exit type)
  exit_threshold: [0.05, 0.10]  # 5% or 10% profit target

  # Stop loss configuration
  stop_loss_type:
    - "none"              # No stop loss (baseline)
    - "fixed_pct"         # Fixed percentage stop loss

  stop_loss_value:
    - null                # No stop loss
    - -0.05               # -5% stop loss
    - -0.10               # -10% stop loss

# Fixed parameters (same as Phase 1 baseline)
fixed_parameters:
  mean_type: "SMA"                # Keep simple moving average
  position_sizing: "fixed"
  position_size: 10000            # $10k per position

  # Filters disabled (Phase 1 baseline)
  use_volume_filter: false
  use_rsi_filter: false
  use_trend_filter: false
  use_volatility_filter: false

# Stock selection
stocks:
  # Use only the 190 profitable stocks from Phase 1
  source: "phase_1_profitable"    # Query from database
  min_return_threshold: 0.0       # Only stocks with positive returns in Phase 1
  candle_type_filter: "regular"   # From regular 1d results
  aggregation_filter: 1           # 1-day candles

  # Fallback if database query not available
  count: 190
  data_path: "data/raw/"

# Backtest period - use full data range like Phase 1
backtest_period:
  start_date: null                # Use first available date for each stock
  end_date: null                  # Use last available date (2025-11-21)

# Execution settings
execution:
  initial_capital: 100000
  commission: 0.001               # 0.1% commission
  slippage: 0.0

  # Performance settings
  parallel: false                 # Sequential to avoid overwhelming EC2
  batch_size: 50                  # Process in batches
  checkpoint_every: 500           # Save progress every 500 backtests

# Walk-forward validation - DISABLED for Phase 2
walk_forward:
  enabled: false                  # Keep it simple - full period testing

# Success criteria for Phase 2
success_criteria:
  min_sharpe: 0.5                 # Target positive Sharpe
  min_return: 0.05                # At least 5% total return
  max_drawdown: 0.20              # Max 20% drawdown
  min_trades: 20                  # At least 20 trades for statistical significance
  min_win_rate: 0.50              # At least 50% win rate

  # Top configs to advance to Phase 3
  top_n: 20                       # Advance top 20 parameter combinations

# Optimization settings
optimization:
  # Primary ranking metric
  primary_metric: "sharpe_ratio"

  # Secondary metrics for tie-breaking
  secondary_metrics:
    - "total_return"
    - "win_rate"
    - "calmar_ratio"              # Return / Max Drawdown

  # Save best parameter combinations
  save_top_configs: 50            # Save top 50 for analysis

# Output settings
output:
  save_to_database: true
  results_dir: "data/results/phase_2"

  # Summary outputs
  generate_summary: true
  summary_path: "data/results/phase_2/phase_2_summary.txt"

  # Detailed outputs (optional)
  save_equity_curves: false       # Skip to save space/time
  save_trade_logs: false          # Skip to save space/time
  generate_heatmaps: true         # Parameter heatmaps helpful
  heatmap_path: "data/results/phase_2/parameter_heatmaps/"

# Logging
logging:
  level: "INFO"
  log_to_file: true
  log_file: "logs/phase_2.log"
  progress_updates_every: 100     # Log every 100 backtests

  # Database logging
  log_to_database: true
  log_config_results: true        # Log each parameter combo result
